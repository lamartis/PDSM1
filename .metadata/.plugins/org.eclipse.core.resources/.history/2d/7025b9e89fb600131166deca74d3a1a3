package com.traitement.integration;

import com.generatedClasses.presentation.Archive;
import com.generatedClasses.integration.ArchiveInfo;
import com.generatedClasses.integration.GetArchivesListResponse;
import com.generatedClasses.presentation.ListArchivesResponse;
import com.generatedClasses.presentation.ListArchivesResponse.Response;
import com.generatedClasses.presentation.User;
import com.interfaces.M2iInterface;
import com.outils.Codeur;

public class GetArchivesListResponseTraitement extends TraitementI {

	GetArchivesListResponse getArchivesListResponse = (GetArchivesListResponse) requete;
	User user;

	public GetArchivesListResponseTraitement(M2iInterface object, String idMessage, String correlationId){
		super(object, idMessage, correlationId);
	}

	public Void call() throws Exception {

		//Preparer le message d'envoie à la présentation
		ListArchivesResponse listArchivesResponse = new ListArchivesResponse();
		listArchivesResponse.setIdentifiant(getArchivesListResponse.getIdentifiant());

		Archive archiveTemp;
		Response response = new Response();

		for (ArchiveInfo archiveFromIntegration : getArchivesListResponse.getArchives()) {
			archiveTemp = new Archive();
			archiveTemp.setIdArchive(archiveFromIntegration.getIdArchive());
			archiveTemp.setNomArchive(archiveFromIntegration.getNomArchive());
			archiveTemp.setNomAuteur(archiveFromIntegration.getNomAuteur());
			archiveTemp.setDateCreation(archiveFromIntegration.getDateCreation());
			response.getArchives().add(archiveTemp);
		}

		listArchivesResponse.setResponse(response);
		responseXMLMessage = Codeur.convert(listArchivesResponse);

		producerM2P.setMessage(responseXMLMessage, idMessage, idCorrelation);
		poolProducers.submit(producerM2P);

		return null;

	}
}
